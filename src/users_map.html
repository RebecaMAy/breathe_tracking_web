<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Usuario - Breathe Tracking</title>

    <!-- Estilos principales -->
    <link rel="stylesheet" href="css/global.css">

    <!-- Leaflet (mapas) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <!-- Iconos Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- Estilos específicos del mapa de usuarios -->
    <link rel="stylesheet" href="css/users_map.css">
</head>

<body>

    <!-- Encabezado principal -->
    <header class="main-header">
        <div class="logo">
            <img src="images/logo-breathe-tracking.png" alt="Breathe Tracking Logo">
        </div>

        <nav class="header-nav">
            <!-- Acceso al perfil -->
            <a href="../src/auth/usuarios.html" class="nav-icon" title="Mi perfil" aria-label="Mi perfil">
                <i class="fas fa-user-circle"></i>
            </a>
            <!-- Cerrar sesión -->
            <a href="index.html" class="nav-button nav-button-ghost">Cerrar Sesión</a>
        </nav>
    </header>

    <main class="main-container">

        <!-- Panel lateral que muestra lista de pines o detalles de un pin -->
        <div id="left-panel" class="left-panel">

            <!-- Vista: lista de pines guardados -->
            <div id="pin-list-view">
                <h3>Mis Puntos Guardados</h3>

                <div class="search-bar">
                    <input type="text" placeholder="Busca tus direcciones...">
                    <button><i class="fas fa-search"></i></button>
                </div>

                <!-- Contenedor donde se renderizan los pines -->
                <div id="pins-container" class="pins-container"></div>
            </div>

            <!-- Vista: detalle de un pin -->
            <div id="pin-detail-view" style="display: none;">
                <h3 id="detail-pin-title">Nombre del Lugar</h3>

                <!-- Información básica del pin -->
                <div class="pin-detail-item">
                    <span>Dirección</span>
                    <p id="detail-direccion">C/...</p>
                    <button class="menu-dots"><i class="fas fa-ellipsis-v"></i></button>
                </div>

                <div class="pin-detail-item">
                    <span>Radio Seguro</span>
                    <p id="detail-ratio">-- km</p>
                </div>

                <div class="pin-detail-item">
                    <span>Última lectura</span>
                    <p id="detail-ultimas-mediciones">--:--</p>
                </div>

                <!-- Sliders de valores ambientales -->
                <div class="slider-group">
                    <label>Ozono</label>
                    <input type="range" id="ozono-slider" min="0" max="1" step="0.05" disabled>
                    <span id="ozono-value">-- ppm</span>
                </div>

                <div class="slider-group">
                    <label>CO2</label>
                    <input type="range" id="radiacion-slider" min="0" max="50" disabled>
                    <span id="radiacion-value">-- ppm</span>
                </div>

                <div class="slider-group">
                    <label>Temperatura</label>
                    <input type="range" id="temperatura-slider" min="0" max="40" disabled>
                    <span id="temperatura-value">-- °C</span>
                </div>

                <!-- Gráfico histórico -->
                <h4 class="activity-title">Nivel de <span id="activity-contaminant-type">Ozono</span></h4>
                <div class="chart-placeholder">
                    <p style="margin:0; font-size: 0.8em; color:#999;">Histórico de Actividad</p>
                </div>

                <!-- Acciones del pin -->
                <div class="detail-actions">
                    <button class="button-primary">Ver Ubicación</button>
                    <button id="delete-pin-btn" class="button-danger">
                        <i class="fas fa-trash"></i> Eliminar
                    </button>
                </div>

                <!-- Volver a la lista de pines -->
                <button class="back-to-list-button" onclick="showPinListView()">
                    ← Volver a mis pines
                </button>
            </div>
        </div>

        <!-- Panel principal del mapa -->
        <div id="map-panel" class="map-panel">

            <!-- Controles superiores del mapa -->
            <div class="map-controls-top">
                <input type="date" id="dateSelector" value="2025-10-01">
                <input type="time" id="timeSelector" value="00:00">

                <!-- Selector del contaminante para el heatmap -->
                <select id="selectorContaminante" onchange="updateHeatmap(this.value)">
                    <option value="O3" selected>Ozono (O₃)</option>
                    <option value="CO2">Dióxido de Carbono</option>
                </select>

                <button class="button-primary">Actualizar</button>
            </div>

            <!-- Contenedor donde Leaflet genera el mapa -->
            <div id="mapa"></div>

            <!-- Modal para nombrar un nuevo pin -->
            <div id="name-pin-modal" class="modal-overlay" style="display: none;">
                <div class="modal-content">
                    <h3>Guardar Nueva Ubicación</h3>
                    <p>Dale un nombre para recordarla:</p>

                    <input type="text" id="new-pin-name-input" placeholder="Ej: Casa de la abuela" autofocus>

                    <div class="modal-actions">
                        <button id="cancel-add-btn" class="button-secondary">Cancelar</button>
                        <button id="confirm-add-btn" class="button-primary">Guardar</button>
                    </div>
                </div>
            </div>

            <!-- Controles inferiores del mapa -->
            <div class="map-controls-bottom">

                <div class="search-bar">
                    <input type="text" placeholder="Buscar dirección...">
                    <button><i class="fas fa-search"></i></button>
                </div>

                <!-- Botón para añadir un marcador -->
                <button id="add-pin-btn" class="button-primary">
                    <i class="fas fa-map-marker-alt"></i> Añadir Marcador
                </button>

                <!-- Controles de zoom -->
                <div class="zoom-controls">
                    <button id="zoom-in-btn">+</button>
                    <button id="zoom-out-btn">-</button>
                </div>
            </div>

            <!-- Botón para mover un marcador existente -->
            <button id="move-pin-btn" class="button-primary" style="display:none;">
                <i class="fas fa-hand-rock"></i> Mover Marcador
            </button>
        </div>
    </main>

    <!-- Scripts del mapa y librerías -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

    <!-- Datos y lógica del mapa -->
    <script src="js/users_map_data.js"></script>
    <script src="js/users_map.js"></script>
</body>

</html>
